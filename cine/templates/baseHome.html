{% load static %}
<!DOCTYPE html>
<html lang="es" data-bs-theme="dark" data-colorblind-mode="normal"> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{% block title %}Aztlan Cinema{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --axolotl-deep-purple: #2b0853ff;
            --axolotl-mid-purple: #4D326C;
            --axolotl-soft-purple: #8B6B9D;
            --axolotl-pink: #F597C4;
            --axolotl-glow: #63E2D9; /* Turquesa bioluminiscente */
            --axolotl-white: #FDF7FF;
            
            --body-font: 'Poppins', sans-serif;
            --title-font: 'Comfortaa', cursive;
        }

        /* --- INICIO: NUEVOS ESTILOS PARA MODOS DE DALTONISMO --- */
        
        /* Protanopia (Rojos débiles): Se cambian rosas y púrpuras por azules y amarillos vibrantes. */
        [data-colorblind-mode="protanopia"] {
            --axolotl-pink: #FFD700; /* Amarillo Oro */
            --axolotl-glow: #00FFFF; /* Cian brillante */
            --axolotl-mid-purple: #3A5FCD; /* Azul Cobalto */
            --axolotl-soft-purple: #6495ED; /* Azul Aciano */
        }
        
        /* Deuteranopia (Verdes débiles): Similar a Protanopia, se usan colores muy distinguibles. */
        [data-colorblind-mode="deuteranopia"] {
            --axolotl-pink: #FFA500; /* Naranja */
            --axolotl-glow: #1E90FF; /* Azul Dodger */
            --axolotl-mid-purple: #483D8B; /* Azul pizarra oscuro */
            --axolotl-soft-purple: #87CEEB; /* Azul cielo */
        }

        /* Tritanopia (Azules débiles): Se evitan azules y amarillos, usando rojos y cianes. */
        [data-colorblind-mode="tritanopia"] {
            --axolotl-pink: #FF1493; /* Rosa Profundo */
            --axolotl-glow: #00CED1; /* Turquesa Oscuro */
            --axolotl-mid-purple: #C71585; /* Violeta Rojo Medio */
            --axolotl-soft-purple: #DB7093; /* Violeta Pálido */
        }

        /* --- FIN: NUEVOS ESTILOS PARA MODOS DE DALTONISMO --- */

        /* --- Configuración General y Fondo --- */
        body {
            background-color: var(--axolotl-deep-purple);
            background-image: 
                radial-gradient(circle at 15% 85%, var(--axolotl-mid-purple), transparent 40%),
                radial-gradient(circle at 85% 20%, var(--axolotl-soft-purple), transparent 40%);
            color: var(--axolotl-white);
            font-family: var(--body-font);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-color 0.5s ease; /* Transición suave */
        }

        /* --- Burbujas de Fondo Animadas --- */
        .bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .bubble {
            position: absolute;
            bottom: -100px;
            background-color: var(--axolotl-pink);
            border-radius: 50%;
            opacity: 0.15;
            animation: rise 15s infinite ease-in;
        }

        .bubble:nth-child(1) { width: 40px; height: 40px; left: 10%; animation-duration: 12s; }
        .bubble:nth-child(2) { width: 20px; height: 20px; left: 20%; animation-duration: 18s; animation-delay: 2s; }
        .bubble:nth-child(3) { width: 50px; height: 50px; left: 35%; animation-duration: 14s; }
        .bubble:nth-child(4) { width: 30px; height: 30px; left: 50%; animation-duration: 20s; animation-delay: 4s; }
        .bubble:nth-child(5) { width: 35px; height: 35px; left: 65%; animation-duration: 16s; }
        .bubble:nth-child(6) { width: 45px; height: 45px; left: 80%; animation-duration: 11s; animation-delay: 1s; }

        @keyframes rise {
            0% {
                transform: translateY(0) translateX(0);
            }
            100% {
                transform: translateY(-120vh) translateX(20px);
            }
        }

        /* --- Barra de Navegación --- */
        .navbar {
            background-color: rgba(34, 36, 95, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--axolotl-mid-purple);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-family: var(--title-font);
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--axolotl-white);
            transition: color 0.3s ease;
        }
        .navbar-brand:hover {
            color: var(--axolotl-pink);
        }

        .axolotl-logo {
            width: 45px;
            margin-right: 10px;
            transition: transform 0.5s ease;
        }
        .navbar-brand:hover .axolotl-logo {
            transform: rotate(15deg) scale(1.1);
        }

        .nav-link {
            color: var(--axolotl-white) !important;
            font-weight: 500;
            padding: 0.5rem 1.5rem !important;
            margin: 0 0.5rem;
            border-radius: 50px;
            transition: all 0.4s ease;
            position: relative;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--axolotl-deep-purple) !important;
            background-color: var(--axolotl-pink);
        }
        
        /* --- Menú Desplegable --- */
        .dropdown-menu {
            background-color: rgba(83, 63, 110, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid var(--axolotl-soft-purple);
            border-radius: 20px;
            padding: 0.5rem 0;
            margin-top: 10px;
        }

        .dropdown-item {
            color: var(--axolotl-white);
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .dropdown-item:hover, .dropdown-item:focus {
            background-color: var(--axolotl-pink);
            color: var(--axolotl-deep-purple);
        }

        /* --- Contenido Principal --- */
        main {
            padding-top: 2rem;
            padding-bottom: 4rem;
        }

        /* --- Botones --- */
        .btn-axolotl {
            background-color: var(--axolotl-pink);
            color: var(--axolotl-deep-purple);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 151, 196, 0.2);
        }
        .btn-axolotl:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(245, 151, 196, 0.4);
            color: var(--axolotl-deep-purple);
        }
        
        .btn-axolotl-outline {
            background-color: transparent;
            color: var(--axolotl-pink);
            border: 2px solid var(--axolotl-pink);
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }
        .btn-axolotl-outline:hover {
            background-color: var(--axolotl-pink);
            color: var(--axolotl-deep-purple);
            transform: translateY(-3px);
        }

        /* --- Tarjetas (si las usas) --- */
        .card-axolotl {
            background-color: rgba(100, 67, 142, 0.5);
            border: 1px solid var(--axolotl-mid-purple);
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(232, 143, 143, 0.2);
        }
        .card-axolotl:hover {
            transform: translateY(-5px);
            border-color: var(--axolotl-pink);
            box-shadow: 0 10px 30px rgba(98, 57, 57, 0.3);
        }

        /* --- Formularios --- */
        .form-control, .form-select {
            background-color: rgba(61, 4, 126, 0.8);
            border: 1px solid var(--axolotl-mid-purple);
            border-radius: 15px;
            color: var(--axolotl-white);
            padding: 0.8rem 1.2rem;
        }
        .form-control:focus, .form-select:focus {
            background-color: var(--axolotl-deep-purple);
            border-color: var(--axolotl-pink);
            box-shadow: 0 0 0 0.2rem rgba(245, 151, 196, 0.25);
            color: var(--axolotl-white);
        }
        
        /* --- Alertas --- */
        .alert {
            border-radius: 15px;
            border: none;
            padding: 1rem 1.5rem;
            color: var(--axolotl-deep-purple);
        }
        .alert-info { background-color: #a7d8de; }
        .alert-success { background-color: var(--axolotl-glow); }
        .alert-warning { background-color: #f7dcb9; }
        .alert-danger { background-color: var(--axolotl-pink); }
        
        /* --- Footer --- */
        footer {
            background-color: rgba(76, 17, 144, 0.7);
            border-top: 1px solid var(--axolotl-mid-purple);
            padding: 2rem 0;
            margin-top: 4rem;
        }
        footer .axolotl-logo {
            width: 30px;
            opacity: 0.7;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: var(--axolotl-deep-purple);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--axolotl-soft-purple);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--axolotl-pink);
        }

        /* --- Hero Section --- */
        .hero-title {
            font-family: var(--title-font);
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--axolotl-white);
            text-shadow: 0 0 15px rgba(245, 151, 196, 0.5);
        }
        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--axolotl-soft-purple);
            max-width: 600px;
            margin: 1rem auto 2rem;
        }
        
        /* --- Responsive --- */
        @media (max-width: 992px) { /* Cambiado a 992 para que los nuevos menus no se rompan */
            .hero-title { font-size: 2.5rem; }
            .hero-subtitle { font-size: 1rem; }
            .navbar-brand { font-size: 1.5rem; }
            .nav-link { margin: 0.3rem 0; }
        }
        
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div class="bubbles">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
    </div>

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
                <svg class="axolotl-logo" viewBox="0 0 100 85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M50 62 C 65 62, 70 75, 50 83 C 30 75, 35 62, 50 62 Z" fill="#F597C4"/>
                    <path d="M50,5 C25,5 20,25 20,40 C20,65 80,65 80,40 C80,25 75,5 50,5 Z" fill="#F597C4"/>
                    <path d="M20 30 C 5 30, 5 15, 20 15" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M20 40 C 5 40, 5 25, 20 25" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M20 50 C 5 50, 5 35, 20 35" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 30 C 95 30, 95 15, 80 15" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 40 C 95 40, 95 25, 80 25" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 50 C 95 50, 95 35, 80 35" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <circle cx="40" cy="38" r="5" fill="#2b0853"/>
                    <circle cx="60" cy="38" r="5" fill="#2b0853"/>
                    <path d="M45 50 C 50 55, 55 55, 60 50" stroke="#D97EAE" stroke-width="3" stroke-linecap="round"/>
                </svg>
                Aztlan Cinema
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div id="nav" class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link{% if request.resolver_match.url_name == 'home' %} active{% endif %}" href="{% url 'home' %}">
                            <i class="bi bi-camera-reels me-2"></i>Cartelera
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-tags me-2"></i>Categorías
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Acción</a></li>
                            <li><a class="dropdown-item" href="#">Comedia</a></li>
                            <li><a class="dropdown-item" href="#">Drama</a></li>
                            <li><a class="dropdown-item" href="#">Ciencia Ficción</a></li>
                            <li><a class="dropdown-item" href="#">Terror</a></li>
                            <li><hr class="dropdown-divider" style="border-color: var(--axolotl-soft-purple);"></li>
                            <li><a class="dropdown-item" href="#">Todas las categorías</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link{% if request.resolver_match.url_name == 'snack_list' %} active{% endif %}" href="{% url 'snack_list' %}">
                            <i class="bi bi-cup-straw me-2"></i>Snacks
                        </a>
                    </li>
                </ul>

<form class="d-flex ms-lg-auto me-lg-3 my-2 my-lg-0 position-relative" role="search" action="{% url 'home' %}" method="get" onsubmit="return false;">
    <input class="form-control me-2" type="search" id="movie-search-input" name="q" placeholder="Buscar película..." aria-label="Buscar" autocomplete="off">
    
    <button class="btn btn-axolotl-outline" type="submit" style="padding: 0.5rem 1rem;">
        <i class="bi bi-search"></i>
    </button>
    
    <div id="search-results" class="list-group position-absolute top-100 start-0 w-100" style="z-index: 1050;">
        </div>
</form>
                <ul class="navbar-nav">
                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Modo de accesibilidad visual">
                            <i class="bi bi-eye"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" id="colorblind-menu">
                            <li><a class="dropdown-item" href="#" data-mode="normal">Modo Normal</a></li>
                            <li><a class="dropdown-item" href="#" data-mode="protanopia">Protanopia (Rojo-Verde)</a></li>
                            <li><a class="dropdown-item" href="#" data-mode="deuteranopia">Deuteranopia (Rojo-Verde)</a></li>
                            <li><a class="dropdown-item" href="#" data-mode="tritanopia">Tritanopia (Azul-Amarillo)</a></li>
                        </ul>
                    </li>
                    {% if request.user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle me-2"></i>{{ request.user.get_short_name|default:request.user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{% url 'orders_list' %}"><i class="bi bi-ticket-perforated me-2"></i>Mis órdenes</a></li>
                                <li><hr class="dropdown-divider" style="border-color: var(--axolotl-soft-purple);"></li>
                                <li>
                                    <form method="post" action="{% url 'logout' %}" class="m-0">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item">
                                            <i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}">
                                <i class="bi bi-box-arrow-in-right me-2"></i>Entrar
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        {% block content %}
        <div class="hero-section text-center py-5">
            <h1 class="hero-title">Bienvenido a Aztlan Cinema</h1>
            <p class="hero-subtitle">Sumérgete en una experiencia encantadora, donde la magia del cine se encuentra.</p>
            <div class="mt-4">
                <a href="#peliculas" class="btn btn-axolotl me-2">
                    <i class="bi bi-play-circle me-2"></i>Ver Cartelera
                </a>
                <a href="{% url 'snack_list' %}" class="btn btn-axolotl-outline">
                    <i class="bi bi-cup-straw me-2"></i>Nuestros Snacks
                </a>
            </div>
        </div>
        {% endblock %}
    </main>

    <footer class="text-center">
        <div class="container">
            <p class="mb-2">
                <svg class="axolotl-logo" viewBox="0 0 100 85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M50 62 C 65 62, 70 75, 50 83 C 30 75, 35 62, 50 62 Z" fill="#F597C4"/>
                    <path d="M50,5 C25,5 20,25 20,40 C20,65 80,65 80,40 C80,25 75,5 50,5 Z" fill="#F597C4"/>
                    <path d="M20 30 C 5 30, 5 15, 20 15" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M20 40 C 5 40, 5 25, 20 25" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M20 50 C 5 50, 5 35, 20 35" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 30 C 95 30, 95 15, 80 15" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 40 C 95 40, 95 25, 80 25" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <path d="M80 50 C 95 50, 95 35, 80 35" stroke="#F597C4" stroke-width="6" stroke-linecap="round" />
                    <circle cx="40" cy="38" r="5" fill="#2b0853"/>
                    <circle cx="60" cy="38" r="5" fill="#2b0853"/>
                    <path d="M45 50 C 50 55, 55 55, 60 50" stroke="#D97EAE" stroke-width="3" stroke-linecap="round"/>
                </svg>
                © {% now "Y" %} Aztlan Cinema · La magia del cine.
            </p>
            <p class="mb-0" style="color: var(--axolotl-soft-purple);">
            
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('movie-search-input');
    const resultsBox = document.getElementById('search-results');
    // La URL para la API de búsqueda que creamos en urls.py
    const searchUrl = "{% url 'search_movies_api' %}";

    searchInput.addEventListener('keyup', function() {
        const query = searchInput.value;

        // Si el campo de búsqueda tiene menos de 2 caracteres, no hacemos nada y limpiamos resultados
        if (query.length < 2) {
            resultsBox.innerHTML = '';
            return;
        }

        // Hacemos la petición AJAX a nuestra vista de Django
        fetch(`${searchUrl}?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                // Limpiamos los resultados anteriores
                resultsBox.innerHTML = '';

                if (data.movies.length > 0) {
                    // Iteramos sobre las películas recibidas en el JSON
                    data.movies.forEach(movie => {
                        // Creamos un enlace <a> para cada resultado
                        const link = document.createElement('a');
                        
                        // Esta es la URL de detalle de la función que querías
                        const showtimeDetailUrl = `/showtime/${movie.showtime_pk}/`;
                        
                        link.href = showtimeDetailUrl;
                        link.textContent = movie.title;
                        link.classList.add('list-group-item', 'list-group-item-action'); // Clases de Bootstrap

                        // Añadimos el enlace al contenedor de resultados
                        resultsBox.appendChild(link);
                    });
                } else {
                    // Si no hay resultados, mostramos un mensaje
                    const noResultItem = document.createElement('div');
                    noResultItem.textContent = 'No se encontraron películas.';
                    noResultItem.classList.add('list-group-item');
                    resultsBox.appendChild(noResultItem);
                }
            })
            .catch(error => {
                console.error('Error durante la búsqueda:', error);
                resultsBox.innerHTML = '<div class="list-group-item">Error al buscar.</div>';
            });
    });

    // Opcional: Ocultar los resultados si el usuario hace clic en cualquier otra parte de la página
    document.addEventListener('click', function(event) {
        if (!searchInput.contains(event.target)) {
            resultsBox.innerHTML = '';
        }
    });
});
</script>
    {% block extra_scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const colorblindMenu = document.getElementById('colorblind-menu');
            const htmlElement = document.documentElement;

            // Función para aplicar el modo de color
            const applyColorMode = (mode) => {
                htmlElement.setAttribute('data-colorblind-mode', mode);
            };

            // Al cargar la página, revisa si hay un modo guardado en localStorage
            const savedMode = localStorage.getItem('colorblindMode');
            if (savedMode) {
                applyColorMode(savedMode);
            }

            // Añade un listener al menú de daltonismo
            colorblindMenu.addEventListener('click', function(event) {
                // Asegúrate de que se hizo clic en un enlace (<a>) con el atributo data-mode
                if (event.target.tagName === 'A' && event.target.dataset.mode) {
                    event.preventDefault(); // Evita que el enlace navegue
                    const mode = event.target.dataset.mode;
                    
                    // Aplica el modo de color
                    applyColorMode(mode);
                    
                    // Guarda la preferencia en localStorage para futuras visitas
                    localStorage.setItem('colorblindMode', mode);
                }
            });
        });
    </script>
    {% endblock %}
</body>
</html>